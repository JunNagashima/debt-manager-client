# フレンド画面 (FRIENDS)

## 画面ID
`FRIENDS`

## 画面の目的
- フレンドの一覧表示と管理
- フレンド申請の送受信管理
- フレンド検索

## 表示要素

### ヘッダー

**中央**
- 画面タイトル: 「フレンド」

**右側**
- フレンド追加ボタン（+人アイコン）

### 検索ボックス

**構成**
- 検索アイコン（左側）
- テキスト入力
- プレースホルダー: 「フレンドを検索」

### フレンド申請セクション（受信）

**ヘッダー**
- タイトル: 「フレンド申請」
- 件数バッジ: 例「2」（赤色）

**フレンド申請カードリスト**

各カードの構成：

**左側**
- アバター
- ユーザー情報
  - ユーザー名: 例「山本 太郎」
  - ユーザーID: 例「@yamamoto_taro」

**右側（アクションボタン）**
- 却下ボタン（×アイコン、赤色）
- 承認ボタン（✓アイコン、緑色）

### 申請中セクション（送信）

**ヘッダー**
- タイトル: 「申請中」
- 件数表示: 例「1件」

**申請中カードリスト**

各カードの構成：

**左側**
- アバター
- ユーザー情報
  - ユーザー名: 例「木村 健一」
  - ユーザーID: 例「@kimura_k」

**右側**
- ステータスバッジ: 「承認待ち」（オレンジ）
- 取り消すボタン

### フレンド一覧セクション

**ヘッダー**
- タイトル: 「フレンド一覧」
- 人数表示: 例「4人」

**フレンドカードリスト**

各カードの構成：

**左側**
- アバター
- フレンド情報
  - ユーザー名: 例「佐藤 花子」
  - 残高状況
    - 貸し: 例「¥6,000 貸し」（緑色）
    - 借り: 例「¥2,500 借り」（赤色）
    - 清算済み: 例「¥0 清算済み」（グレー）

**右側**
- メニューボタン（3点ドット）

## ユーザーアクション

| アクション | トリガー | 遷移先/処理 | 使用API |
|---|---|---|---|
| フレンド追加 | +ボタンクリック | フレンド追加モーダル表示 | - |
| フレンド検索 | 検索ボックス入力 | リストのフィルタリング（クライアント側） | - |
| 申請承認 | 承認ボタンクリック | 承認確認モーダル表示 | - |
| 申請却下 | 却下ボタンクリック | 却下確認モーダル表示 | - |
| 申請取消 | 取り消すボタンクリック | 取消確認モーダル表示 | - |
| フレンド詳細 | フレンドカードクリック | 残高詳細画面へ遷移 | - |
| フレンドメニュー | メニューボタンクリック | フレンドメニューモーダル表示 | - |

## モーダル一覧

### modal-add-friend（フレンド追加）

**表示項目**
- タイトル: 「フレンド追加」
- 閉じるボタン（×）

**フォーム項目**
1. ユーザーID
   - テキスト入力
   - プレースホルダー: 「例: @yamamoto_taro」
   - ヒント: 「相手のユーザーIDを入力してください」

**ボタン**
- キャンセルボタン（セカンダリ）
- 申請を送るボタン（プライマリ）

### modal-accept-confirm（承認確認）

**表示項目**
- タイトル: 「フレンド申請の承認」
- 閉じるボタン（×）

**ユーザーカード**（中央揃え）
- アバター（大きく表示）
- ユーザー名: 例「山本 太郎」
- ユーザーID: 例「@yamamoto_taro」

**確認メッセージ**
- 「このユーザーをフレンドに追加しますか？」

**ボタン**
- キャンセルボタン（セカンダリ）
- 承認するボタン（プライマリ）

### modal-reject-confirm（却下確認）

**表示項目**
- タイトル: 「フレンド申請の却下」
- 閉じるボタン（×）

**確認メッセージ**
- 「このフレンド申請を却下しますか？」
- ユーザー名: 例「山本 太郎さん」

**注記**
- 「この操作は取り消せません」

**ボタン**
- キャンセルボタン（セカンダリ）
- 却下するボタン（デンジャー）

### modal-cancel-request（申請取消確認）

**表示項目**
- タイトル: 「フレンド申請の取消」
- 閉じるボタン（×）

**確認メッセージ**
- 「このフレンド申請を取り消しますか？」
- ユーザー名: 例「木村 健一さん」

**ボタン**
- キャンセルボタン（セカンダリ）
- 取り消すボタン（デンジャー）

### modal-friend-menu（フレンドメニュー）

**表示項目**
- タイトル: フレンド名（例：「佐藤 花子」）
- 閉じるボタン（×）

**メニュー項目**
- 残高を確認（リンク）
- フレンドを削除（デンジャー）

## 使用API

### 初期表示時

**フレンド一覧取得**
```
GET /api/v1/friends
```
レスポンス例:
```json
[
  {"id": "user_002", "name": "佐藤花子"},
  {"id": "user_003", "name": "鈴木一郎"}
]
```

**フレンド申請一覧取得**
```
GET /api/v1/friends/requests
```
レスポンス例:
```json
{
  "incoming": [
    {
      "id": "frq_002",
      "user": {"id": "user_003", "name": "鈴木一郎"},
      "createdAt": "2025-10-22T10:00:00Z"
    }
  ],
  "outgoing": [
    {
      "id": "frq_001",
      "user": {"id": "user_002", "name": "佐藤花子"},
      "createdAt": "2025-10-22T09:00:00Z"
    }
  ]
}
```

**各フレンドの残高取得**
```
GET /api/v1/balances
```
レスポンス例:
```json
[
  {
    "user": {"id": "user_002", "name": "佐藤花子"},
    "net": {"lent": 6000, "borrowed": 0}
  }
]
```

### フレンド申請送信時

```
POST /api/v1/friends/requests
```
リクエストボディ:
```json
{
  "targetUserId": "user_002"
}
```
レスポンス: 201 Created

### フレンド申請承認時

```
POST /api/v1/friends/requests/:requestId/approve
```
レスポンス: 200 OK

### フレンド申請取消時

（API未定義：将来的にキャンセルAPIを追加予定）

## 画面遷移

### 遷移元
- ホーム画面
- ボトムナビゲーション

### 遷移先
- 残高詳細画面: フレンドカードクリック時

## 実装時の注意事項

1. **検索機能**
   - クライアント側でフィルタリング
   - ユーザー名とユーザーIDで部分一致検索
   - 検索結果は即座に反映

2. **フレンド申請の表示**
   - 受信した申請が優先表示
   - 未対応の申請を見逃さないようにバッジ表示

3. **残高の表示**
   - フレンド一覧には各フレンドの残高を併記
   - 残高APIのレスポンスと結合

4. **申請の却下**
   - 却下機能は仕様上存在しないが、UIには配置
   - 実装時は「無視」として扱う（申請レコードを削除しない）

5. **空の状態**
   - フレンドがいない場合: 「まだフレンドがいません」
   - 申請がない場合: セクション自体を非表示

6. **エラーハンドリング**
   - ユーザーIDが存在しない場合: 404エラー
   - 既にフレンドの場合: 409エラー
   - 適切なエラーメッセージ表示

7. **リアルタイム更新**
   - 申請承認後は一覧を自動更新
   - フレンド追加後は一覧を自動更新

8. **アクセシビリティ**
   - ボタンにはaria-label
   - カードはキーボードで操作可能

9. **パフォーマンス**
   - フレンド一覧は仮想スクロール（大量のフレンドに対応）
   - アバター画像の遅延読み込み
